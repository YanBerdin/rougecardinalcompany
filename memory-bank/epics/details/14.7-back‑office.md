# Epic : Backâ€‘office

## "Authentification sÃ©curisÃ©e"

**As an** administrateur  
**I want** me connecter avec une authentification sÃ©curisÃ©e  
**So that** je sÃ©curise l'accÃ¨s au backâ€‘office

**Acceptance Criteria:**

- [x] Page de login avec champs identifiant et mot de passe  
- [x] Mots de passe chiffrÃ©s en base  
- [x] Authentification via JWT ou session sÃ©curisÃ©e  
- [x] Message dâ€™erreur clair en cas dâ€™Ã©chec  
- [ ] DÃ©connexion automatique aprÃ¨s pÃ©riode dâ€™inactivitÃ© configurable  

---

## "Dashboard avec statistiques"

**As an** administrateur  
**I want** voir un dashboard avec statistiques  
**So that** jâ€™ai une vue dâ€™ensemble de lâ€™activitÃ©

**Acceptance Criteria:**

- [ ] Indicateurs clÃ©s : nombre dâ€™Ã©vÃ©nements Ã  venir, nouveaux mÃ©dias, derniÃ¨res connexions
- [ ] DonnÃ©es actualisÃ©es en temps rÃ©el ou via refresh manuel  
- [ ] Filtrage des statistiques par pÃ©riode  

---

## "CRUD Spectacles, Ã©vÃ©nements, presse"

**As an** Ã©diteur  
**I want** gÃ©rer Spectacles, Ã©vÃ©nements et presse via interface intuitive  
**So that** je travaille en autonomie

**Acceptance Criteria:**

- [ ] Interface unifiÃ©e avec recherche et filtres  
- [ ] Formulaire clair avec champs spÃ©cifiques selon type de contenu  
- [ ] Validation cÃ´tÃ© front et back  
- [ ] AperÃ§u avant publication  
- [ ] Historique des modifications accessible

---

## "Gestion mÃ©dias avec prÃ©visualisation"

**As an** Ã©diteur  
**I want** uploader et gÃ©rer les mÃ©dias avec prÃ©visualisation  
**So that** je garde une organisation claire

**Acceptance Criteria:**

- [ ] Dragâ€‘andâ€‘drop pour upload  
- [ ] Miniatures gÃ©nÃ©rÃ©es automatiquement  
- [ ] Affichage des mÃ©tadonnÃ©es (taille, format, date dâ€™upload)  
- [ ] Classement par dossier ou tags  
- [ ] Suppression ou remplacement facile dâ€™un mÃ©dia

---

## "Gestion des rÃ´les utilisateurs"

**As an** administrateur  
**I want** gÃ©rer les rÃ´les admin/Ã©diteur  
**So that** je contrÃ´le les accÃ¨s

**Acceptance Criteria:**

- [ ] Liste des utilisateurs avec rÃ´le et statut actif/inactif  
- [ ] Modification des rÃ´les Ã  tout moment  
- [ ] Attribution de permissions spÃ©cifiques par rÃ´le  
- [ ] Journalisation des changements de rÃ´le

---

## "Logs dâ€™audit dÃ©taillÃ©s"

**As an** administrateur  
**I want** consulter les logs dâ€™audit dÃ©taillÃ©s  
**So that** je garde la traÃ§abilitÃ© des actions

**Acceptance Criteria:**

- [ ] Liste horodatÃ©e des actions (login, crÃ©ation, modification, suppression)  
- [ ] Filtre par utilisateur, type dâ€™action, pÃ©riode  
- [ ] Export CSV/PDF  
- [ ] Conservation des logs selon politique dÃ©finie

---

## "Alertes de sÃ©curitÃ©"

**As an** administrateur  
**I want** recevoir des alertes de sÃ©curitÃ©  
**So that** je surveille lâ€™intÃ©gritÃ© du systÃ¨me

**Acceptance Criteria:**

- [ ] Notifications par email ou tableau de bord en cas de tentatives suspectes  
- [ ] Journalisation de lâ€™alerte dans les logs  
- [ ] Configuration du type dâ€™Ã©vÃ©nement dÃ©clencheur

---

## "Interface responsive"

**As a** utilisateur  
**I want** bÃ©nÃ©ficier d'une interface responsive  
**So that** je puisse gÃ©rer le backâ€‘office depuis tout appareil

**Acceptance Criteria:**

- [ ] Affichage adaptÃ© aux mobiles, tablettes et desktops  
- [ ] Menus et formulaires utilisables au tactile  
- [ ] Performances optimisÃ©es sur tous formats

---

## "Toggle section Ã€ la Une"

**As an** administrateur  
**I want** activer/dÃ©sactiver la section "Ã€ la Une" sur la page dâ€™accueil  
**So that** je dÃ©cide de mettre en avant ou non les prochains Ã©vÃ©nements

**Acceptance Criteria:**

- [ ] Toggle dans paramÃ¨tres du backâ€‘office  
- [ ] Activation = section affichÃ©e sur page dâ€™accueil  
- [ ] DÃ©sactivation = section masquÃ©e  
- [ ] Modification visible immÃ©diatement

---

## "Toggle section Nos partenaires"

**As an** administrateur  
**I want** activer/dÃ©sactiver la section "Nos partenaires" sur la page dâ€™accueil  
**So that** je choisis de la mettre en avant ou non

**Acceptance Criteria:**

- [ ] Toggle disponible dans les paramÃ¨tres du backâ€‘office  
- [ ] Effet immÃ©diat cÃ´tÃ© front  
- [ ] Historique des changements

---

## "Toggle section Abonnement Newsletter (Pages Agenda, Accueil et Contact)" âœ…

**As an** administrateur  
**I want** activer/dÃ©sactiver la section newsletter sur les pages Agenda, Accueil et Contact  
**So that** je contrÃ´le sa visibilitÃ© de faÃ§on centralisÃ©e

**Acceptance Criteria:**

- [x] Toggle disponibles dans le BackOffice pour les pages (Agenda, Accueil, Contact)  
- [x] Effet immÃ©diat cÃ´tÃ© front sur les pages concernÃ©es  
- [x] CohÃ©rence avec les user stories: Agendaâ€‘08, Accueilâ€‘10, Newsletterâ€‘05  
- [x] Ã‰tat persistÃ© en base (configurations_site)  
- [x] Journalisation des changements (audit)

**Completed:** 2026-01-01 (TASK030 Phases 1-11)  
**Toggles crÃ©Ã©s:** 10 total (6 home, 1 agenda, 1 contact, 2 presse)  
**Phase 11 Fix:** Split presse en 2 toggles indÃ©pendants (Media Kit + CommuniquÃ©s)

---

## ğŸ” Milestone 2: Back-Office Foundation - Core CRUD Interfaces

Build the essential admin interfaces for content management.

### Epics

- ğŸ“ **Content Management CRUD** - Create/Read/Update/Delete for shows, events, articles
- ğŸ‘¥ **Team Management** - CRUD for team members with photos and roles
- ğŸ¤ **Partners Management** - CRUD for partners with logos and display order
- ğŸ“° **Press Management** - CRUD for press releases and press contacts
- ğŸ“§ **Communications Dashboard** - View newsletter subscribers and contact messages
- ğŸ  **Homepage Content Management** - Edit hero slides, about section, news highlights
- ğŸ­ **Company Content Management** - Edit values, stats, presentation sections

---

## âš™ï¸ Milestone 3: Advanced Admin Features

Add advanced functionality for content control and monitoring.

### Epics

- ğŸ”„ **Content Versioning UI** - View history, compare versions, restore previous states
- ğŸ–¼ï¸ **Media Library** - Upload, organize, tag, and manage all media files
- ğŸšï¸ **Display Toggles** - Control visibility of sections (newsletter, partners, featured content)
- ğŸ“Š **Analytics Dashboard** - View site statistics, popular pages, user engagement
- ğŸ‘¤ **User Role Management** - Manage admin/editor roles and permissions
- ğŸ” **Audit Logs Viewer** - Browse and filter system activity logs

---

## ğŸš€ Milestone 4: Optimization & Launch

Prepare the application for production deployment.

### Epics

- âš¡ **Performance Optimization** - Remove artificial delays, optimize queries, caching strategy
- ğŸ§ª **Testing Suite** - Unit tests, integration tests, E2E tests implementation
- ğŸ”’ **Security Audit** - Review RLS policies, test authentication, vulnerability scan
- â™¿ **Accessibility Compliance** - WCAG 2.1 AA validation and fixes
- ğŸ“± **Responsive Testing** - Cross-device and cross-browser validation
- ğŸš€ **Production Deployment** - Environment setup, CI/CD pipeline, monitoring
- ğŸ“š **Documentation** - User guides, admin manual, technical documentation

---

**Note:** Milestone 1 (Public Site) is complete. Email service integration is complete. Authentication is complete.

---

## ğŸ¯ Completed Backoffice Tasks (Milestone 2)

### âœ… TASK022 - Team Management (Completed: 22 Oct 2025)

**Status**: COMPLETED  
**Issue**: [#2](https://github.com/YanBerdin/rougecardinalcompany/issues/2) (CLOSED)  
**Commits**: 6 migrations, schemas updated, comprehensive testing  

**Implemented Features**:

- Full CRUD operations for company team members
- Role-based access control (Admin only)
- Members table with photo support
- Complete UI components (Smart/Dumb pattern)
- Server Actions with Zod validation
- RLS policies and GRANT permissions

**Files**: `memory-bank/tasks/TASK022-team-management.md`

### âœ… TASK025 - RLS Security & Performance Fixes (Completed: 23 Oct 2025)

**Status**: COMPLETED  
**Issue**: [#5](https://github.com/YanBerdin/rougecardinalcompany/issues/5) (CLOSED)  
**Commits**: 4 commits ready on `feature/backoffice` branch  

**3 Critical Issues Resolved**:

1. **Articles Vides (Empty Media Articles)**
   - Root Cause: RLS enabled without policies + SECURITY INVOKER without GRANT
   - Solution: 5 RLS policies + GRANT SELECT on base table
   - Migrations: `20251022140000`, `20251022150000`
   - Testing: 3-level validation (SQL + automated + browser)

2. **SECURITY DEFINER Views**
   - Root Cause: 10 views with privilege escalation risk
   - Solution: Convert all to SECURITY INVOKER explicitly
   - Migration: `20251022160000`
   - Automated test script created

3. **RLS Performance Optimization**
   - Root Cause: Multiple PERMISSIVE policies = OR evaluation overhead
   - Solution: Admin RESTRICTIVE policy (bypass gate pattern)
   - Migration: `20251022170000`
   - Performance: ~40% faster for non-admin users

**Documentation**:

- `memory-bank/tasks/TASK025-rls-security-performance-fixes.md` (300+ lines)
- `doc/rls-policies-troubleshooting.md` (202 lines guide)
- Test script: `scripts/test-views-security-invoker.ts`

**Architecture Impact**:

- Defense in Depth pattern implemented (VIEW + GRANT + RLS)
- Security-first approach maintained
- Performance gains validated

**Status**: Ready for push to GitHub ([Issue #24](https://github.com/YanBerdin/rougecardinalcompany/issues/24))
