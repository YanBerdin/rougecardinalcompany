# Epic : Back‑office

## "Authentification sécurisée"

**As an** administrateur  
**I want** me connecter avec une authentification sécurisée  
**So that** je sécurise l'accès au back‑office

**Acceptance Criteria:**

- [x] Page de login avec champs identifiant et mot de passe  
- [x] Mots de passe chiffrés en base  
- [x] Authentification via JWT ou session sécurisée  
- [x] Message d’erreur clair en cas d’échec  
- [ ] Déconnexion automatique après période d’inactivité configurable  

---

## "Dashboard avec statistiques"

**As an** administrateur  
**I want** voir un dashboard avec statistiques  
**So that** j’ai une vue d’ensemble de l’activité

**Acceptance Criteria:**

- [ ] Indicateurs clés : nombre d’événements à venir, nouveaux médias, dernières connexions
- [ ] Données actualisées en temps réel ou via refresh manuel  
- [ ] Filtrage des statistiques par période  

---

## "CRUD Spectacles, événements, presse"

**As an** éditeur  
**I want** gérer Spectacles, événements et presse via interface intuitive  
**So that** je travaille en autonomie

**Acceptance Criteria:**

- [ ] Interface unifiée avec recherche et filtres  
- [ ] Formulaire clair avec champs spécifiques selon type de contenu  
- [ ] Validation côté front et back  
- [ ] Aperçu avant publication  
- [ ] Historique des modifications accessible

---

## "Gestion médias avec prévisualisation"

**As an** éditeur  
**I want** uploader et gérer les médias avec prévisualisation  
**So that** je garde une organisation claire

**Acceptance Criteria:**

- [ ] Drag‑and‑drop pour upload  
- [ ] Miniatures générées automatiquement  
- [ ] Affichage des métadonnées (taille, format, date d’upload)  
- [ ] Classement par dossier ou tags  
- [ ] Suppression ou remplacement facile d’un média

---

## "Gestion des rôles utilisateurs"

**As an** administrateur  
**I want** gérer les rôles admin/éditeur  
**So that** je contrôle les accès

**Acceptance Criteria:**

- [ ] Liste des utilisateurs avec rôle et statut actif/inactif  
- [ ] Modification des rôles à tout moment  
- [ ] Attribution de permissions spécifiques par rôle  
- [ ] Journalisation des changements de rôle

---

## "Logs d’audit détaillés"

**As an** administrateur  
**I want** consulter les logs d’audit détaillés  
**So that** je garde la traçabilité des actions

**Acceptance Criteria:**

- [ ] Liste horodatée des actions (login, création, modification, suppression)  
- [ ] Filtre par utilisateur, type d’action, période  
- [ ] Export CSV/PDF  
- [ ] Conservation des logs selon politique définie

---

## "Alertes de sécurité"

**As an** administrateur  
**I want** recevoir des alertes de sécurité  
**So that** je surveille l’intégrité du système

**Acceptance Criteria:**

- [ ] Notifications par email ou tableau de bord en cas de tentatives suspectes  
- [ ] Journalisation de l’alerte dans les logs  
- [ ] Configuration du type d’événement déclencheur

---

## "Interface responsive"

**As a** utilisateur  
**I want** bénéficier d'une interface responsive  
**So that** je puisse gérer le back‑office depuis tout appareil

**Acceptance Criteria:**

- [ ] Affichage adapté aux mobiles, tablettes et desktops  
- [ ] Menus et formulaires utilisables au tactile  
- [ ] Performances optimisées sur tous formats

---

## "Toggle section À la Une"

**As an** administrateur  
**I want** activer/désactiver la section "À la Une" sur la page d’accueil  
**So that** je décide de mettre en avant ou non les prochains événements

**Acceptance Criteria:**

- [ ] Toggle dans paramètres du back‑office  
- [ ] Activation = section affichée sur page d’accueil  
- [ ] Désactivation = section masquée  
- [ ] Modification visible immédiatement

---

## "Toggle section Nos partenaires"

**As an** administrateur  
**I want** activer/désactiver la section "Nos partenaires" sur la page d’accueil  
**So that** je choisis de la mettre en avant ou non

**Acceptance Criteria:**

- [ ] Toggle disponible dans les paramètres du back‑office  
- [ ] Effet immédiat côté front  
- [ ] Historique des changements

---

## "Toggle section Abonnement Newsletter (Pages Agenda, Accueil et Contact)"

**As an** administrateur  
**I want** activer/désactiver la section newsletter sur les pages Agenda, Accueil et Contact  
**So that** je contrôle sa visibilité de façon centralisée

**Acceptance Criteria:**

- [ ] Toggle disponibles dans le BackOffice pour les pages (Agenda, Accueil, Contact)  
- [ ] Effet immédiat côté front sur les pages concernées  
- [ ] Cohérence avec les user stories: Agenda‑08, Accueil‑10, Newsletter‑05  
- [ ] État persisté en base (configurations)  
- [ ] Journalisation des changements (audit)

---

## 🔐 Milestone 2: Back-Office Foundation - Core CRUD Interfaces

Build the essential admin interfaces for content management.

### Epics

- 📝 **Content Management CRUD** - Create/Read/Update/Delete for shows, events, articles
- 👥 **Team Management** - CRUD for team members with photos and roles
- 🤝 **Partners Management** - CRUD for partners with logos and display order
- 📰 **Press Management** - CRUD for press releases and press contacts
- 📧 **Communications Dashboard** - View newsletter subscribers and contact messages
- 🏠 **Homepage Content Management** - Edit hero slides, about section, news highlights
- 🎭 **Company Content Management** - Edit values, stats, presentation sections

---

## ⚙️ Milestone 3: Advanced Admin Features

Add advanced functionality for content control and monitoring.

### Epics

- 🔄 **Content Versioning UI** - View history, compare versions, restore previous states
- 🖼️ **Media Library** - Upload, organize, tag, and manage all media files
- 🎚️ **Display Toggles** - Control visibility of sections (newsletter, partners, featured content)
- 📊 **Analytics Dashboard** - View site statistics, popular pages, user engagement
- 👤 **User Role Management** - Manage admin/editor roles and permissions
- 🔍 **Audit Logs Viewer** - Browse and filter system activity logs

---

## 🚀 Milestone 4: Optimization & Launch

Prepare the application for production deployment.

### Epics

- ⚡ **Performance Optimization** - Remove artificial delays, optimize queries, caching strategy
- 🧪 **Testing Suite** - Unit tests, integration tests, E2E tests implementation
- 🔒 **Security Audit** - Review RLS policies, test authentication, vulnerability scan
- ♿ **Accessibility Compliance** - WCAG 2.1 AA validation and fixes
- 📱 **Responsive Testing** - Cross-device and cross-browser validation
- 🚀 **Production Deployment** - Environment setup, CI/CD pipeline, monitoring
- 📚 **Documentation** - User guides, admin manual, technical documentation

---

**Note:** Milestone 1 (Public Site) is complete. Email service integration is complete. Authentication is complete.

---

## 🎯 Completed Backoffice Tasks (Milestone 2)

### ✅ TASK022 - Team Management (Completed: 22 Oct 2025)

**Status**: COMPLETED  
**Issue**: [#2](https://github.com/YanBerdin/rougecardinalcompany/issues/2) (CLOSED)  
**Commits**: 6 migrations, schemas updated, comprehensive testing  

**Implemented Features**:

- Full CRUD operations for company team members
- Role-based access control (Admin only)
- Members table with photo support
- Complete UI components (Smart/Dumb pattern)
- Server Actions with Zod validation
- RLS policies and GRANT permissions

**Files**: `memory-bank/tasks/TASK022-team-management.md`

### ✅ TASK025 - RLS Security & Performance Fixes (Completed: 23 Oct 2025)

**Status**: COMPLETED  
**Issue**: [#5](https://github.com/YanBerdin/rougecardinalcompany/issues/5) (CLOSED)  
**Commits**: 4 commits ready on `feature/backoffice` branch  

**3 Critical Issues Resolved**:

1. **Articles Vides (Empty Media Articles)**
   - Root Cause: RLS enabled without policies + SECURITY INVOKER without GRANT
   - Solution: 5 RLS policies + GRANT SELECT on base table
   - Migrations: `20251022140000`, `20251022150000`
   - Testing: 3-level validation (SQL + automated + browser)

2. **SECURITY DEFINER Views**
   - Root Cause: 10 views with privilege escalation risk
   - Solution: Convert all to SECURITY INVOKER explicitly
   - Migration: `20251022160000`
   - Automated test script created

3. **RLS Performance Optimization**
   - Root Cause: Multiple PERMISSIVE policies = OR evaluation overhead
   - Solution: Admin RESTRICTIVE policy (bypass gate pattern)
   - Migration: `20251022170000`
   - Performance: ~40% faster for non-admin users

**Documentation**:

- `memory-bank/tasks/TASK025-rls-security-performance-fixes.md` (300+ lines)
- `doc/rls-policies-troubleshooting.md` (202 lines guide)
- Test script: `scripts/test-views-security-invoker.ts`

**Architecture Impact**:

- Defense in Depth pattern implemented (VIEW + GRANT + RLS)
- Security-first approach maintained
- Performance gains validated

**Status**: Ready for push to GitHub ([Issue #24](https://github.com/YanBerdin/rougecardinalcompany/issues/24))
