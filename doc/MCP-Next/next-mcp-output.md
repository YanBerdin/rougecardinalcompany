
```json
{"success":true,"project_path":"/home/yandev/projets/rougecardinalcompany",
"description":"Next.js 16 Upgrade Guide","guidance":"You are a Next.js upgrade assistant. Help upgrade this project from Next.js 15 (or earlier) to Next.js 16.\n\nPROJECT: /home/yandev/projets/rougecardinalcompany\n\n# REQUIRED: Load Migration Guide Resource\n\n**Before starting the upgrade, load the complete migration guide:**\n\n```\nRead resource \"nextjs16://migration/examples\"\n```\n\nThis resource contains:\n- üö® Quick reference of all breaking changes\n- ‚úÖ Complete checklist\n- üìñ All code examples with search commands\n- üîß Step-by-step implementation patterns\n\n**Additional Knowledge Resources (load as needed):**\n- `nextjs16://knowledge/overview` - Critical errors AI agents make\n- `nextjs16://knowledge/request-apis` - Detailed async API patterns\n- `nextjs16://knowledge/cache-invalidation` - Cache invalidation semantics\n- `nextjs16://knowledge/error-patterns` - Common errors and solutions\n- `nextjs16://knowledge/test-patterns` - Test-driven patterns\n- `nextjs16://knowledge/reference` - Complete API reference\n\n**Note:** Resource URIs use the `nextjs16://` scheme regardless of your MCP server name.\n\n---\n\n# UPGRADE WORKFLOW: Next.js 15 ‚Üí 16 Migration Guide\n\nThe section below contains the step-by-step upgrade workflow. Load the knowledge base resources above for detailed technical behavior, API semantics, and best practices.\n\n## PHASE 1: Pre-Flight Checks (REQUIRED)\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nCheck these BEFORE running the codemod:\n\n0. **Detect Monorepo Structure (CRITICAL)**\n   ‚ö†Ô∏è **If this is a monorepo,
 you MUST run the upgrade flow on each individual app, NOT at the monorepo root**\n   \n   Check for monorepo indicators:\n   - Workspace configuration: `workspaces` field in root package.json\n   - Monorepo tools: pnpm-workspace.yaml, lerna.json, nx.json, turbo.json\n   - Multiple app directories: apps/, packages/, services/ folders\n   \n   **If monorepo detected:**\n   ```bash\n   # Find all Next.js apps in the monorepo\n   find . -name \"package.json\" -not -path \"*/node_modules/*\" -exec grep -l \"\\\"next\\\":\" {} \\;\n   ```\n   \n   **For each Next.js app found:**\n   - Navigate to that app's directory: `cd apps/web` (or wherever the app is)\n   - Run the ENTIRE upgrade workflow from that directory\n   - The codemod will fail if run from monorepo root\n   \n   Example for typical monorepo structure:\n   ```bash\n   # If you have: apps/web, apps/admin, apps/marketing\n   cd apps/web && [run upgrade workflow here]\n   cd ../admin && [run upgrade workflow here]\n   cd ../marketing && [run upgrade workflow here]\n   ```\n\n1. **Detect Package Manager**\n   Check: package.json \"packageManager\" field or lock files\n\n   **Template Variables:**\n   ```\n   npm:   <pkg-manager> = npm        <pkg-exec> = npx\n   pnpm:  <pkg-manager> = pnpm       <pkg-exec> = pnpx\n   yarn:  <pkg-manager> = yarn       <pkg-exec> = yarn dlx\n   bun:   <pkg-manager> = bun        <pkg-exec> = bunx\n   ```\n\n   Use these template variables in ALL commands below for consistency\n\n2. **Node.js Version**\n   Required: Node.js 20.9+\n   Check: node --version\n   Action: Upgrade if < 20.9.0\n\n3. **TypeScript Version**\n   Required: TypeScript 5.1+\n   Check: package.json ‚Üí devDependencies.typescript\n   Note: Document if upgrade needed (codemod won't upgrade this)\n   Action: If < 5.1,
plan to upgrade after codemod\n\n4. **Browser Support** (Informational)\n   Next.js 16 requires these minimum browser versions:\n   - Chrome 111+\n   - Edge 111+\n   - Firefox 111+\n   - Safari 16.4+\n   Note: No action needed, but verify your target audience supports these versions\n\n5. **Current Next.js Version**\n   Check: package.json ‚Üí dependencies.next\n   \n   ```bash\n   # Check current version\n   grep '\"next\":' package.json\n   ```\n   \n   **If on beta channel:**\n   - Current: `\"next\": \"16.0.0-beta.X\"` or `\"next\": \"beta\"`\n   - Action: Will upgrade to latest stable\n   - Note: Beta users should upgrade to stable now that it's released\n   \n   Note: Document current version for rollback\n\n6. **Git Status**\n   Check: git status\n   Action: Ensure working directory is clean (no uncommitted changes)\n   Why: The codemod requires a clean git state to run\n\n## PHASE 2: Run Automated Codemod\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n‚ö†Ô∏è **IMPORTANT: Run this BEFORE making any manual changes**\n\nThe codemod requires a clean git working directory. It will fail with this error if you have uncommitted changes:\n> But before we continue, 
please stash or commit your git changes\n\nRun the official codemod to handle most changes automatically:\n\n**Note**: Next.js 16 stable (version 16.0.6) is now available.\n\n```bash\n# This will:\n# - Upgrade Next.js, React, and React DOM to latest versions\n# - Upgrade @types/react and @types/react-dom to latest\n# - Convert async params/searchParams automatically\n# - Update experimental config locations\n# - Fix other breaking changes\n<pkg-exec> @next/codemod@canary upgrade latest\n```\n\n**Note:** When prompted for options during codemod execution, select \"yes\" for all selections to apply all recommended changes.\n\n**What the codemod handles:**\n- ‚úÖ Upgrades Next.js, React, and React DOM to latest versions\n- ‚úÖ Upgrades React type definitions to latest\n- ‚úÖ Converts sync params/searchParams to async (most cases)\n- ‚úÖ Updates experimental config locations\n- ‚úÖ Fixes metadata generation functions\n- ‚úÖ Updates deprecated imports\n\n**What the codemod does NOT handle:**\n- ‚ùå TypeScript version upgrade (do this manually if needed)\n\n**After codemod completes:**\n1. **If you were on beta:** Load the beta-to-stable migration resource for additional config changes:\n   ```\n   Read resource \"nextjs16://migration/beta-to-stable\"\n   ```\n   Key changes: `experimental.cacheLife` ‚Üí `cacheLife` (move to root level)\n\n2. Review the git diff to see what changed\n\n3. If TypeScript < 5.0, upgrade it now:\n   ```bash\n   <pkg-manager> add -D typescript@latest\n   ```\n\n4. **Verify the upgrade by running a build:**\n   ```bash\n   <pkg-manager> run build\n   # If this succeeds, the automated upgrade is complete\n   # If it fails, proceed to Phase 3 to identify and fix remaining issues\n   ```\n\n4. **Browser Verification with browser_eval (RECOMMENDED):**\n   After the build succeeds, verify pages actually load correctly in a browser:\n   \n   a. Start the Next.js dev server:\n   ```bash\n   <pkg-manager> run dev\n   ```\n   \n   b. Use the browser_eval MCP tool to verify pages load correctly:\n   ```\n   # Start browser automation\n   Use browser_eval tool with action=\"start\"\n   \n   # Navigate to key pages and verify they load\n   Use browser_eval tool with action=\"navigate\", url=\"http://localhost:3000\"\n   Use browser_eval tool with action=\"navigate\", url=\"http://localhost:3000/users/1\"\n   # ... test other important routes\n   \n   # Check for console errors\n   Use browser_eval tool with action=\"console_messages\", errorsOnly=true\n   \n   # Close browser when done\n   Use browser_eval tool with action=\"close\"\n   ```\n   \n   **Why browser_eval instead of curl:**\n   - ‚úÖ browser_eval actually renders the page and executes JavaScript\n   - ‚úÖ Detects runtime errors that curl/HTTP requests cannot catch\n   - ‚úÖ Verifies client-side hydration and React component mounting\n   - ‚úÖ Captures browser console errors and warnings\n   - ‚úÖ Tests the full user experience, not just HTTP status codes\n   \n   **Note:** If you only use curl or simple HTTP GET requests, you'll miss client-side errors, hydration issues, and JavaScript runtime problems.\n\n**Wait for codemod to complete and verify both build and browser tests before proceeding to Phase 3**\n\n## PHASE 3: Analyze Remaining Issues\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nAfter the codemod runs, check for any remaining issues it might have missed:\n\n### Manual Check Checklist:\n\n**A. Completely Removed Features (NOT handled by codemod)**\n   Check your codebase for these removed APIs and configs.\n   \n   **üìñ For detailed code examples, see: `nextjs16://migration/examples` (Removed Features Examples)**\n\n   **1. AMP Support Removed:**\n   - Search: `grep -r \"useAmp\\|amp:\" app/ src/ pages/`\n   - Remove all AMP-related code: `useAmp` hook, `export const config = { amp: true }`\n   - No replacement available - AMP support completely removed\n\n   **2. Runtime Config Removed:**\n   - Search: `grep -r \"serverRuntimeConfig\\|publicRuntimeConfig\" next.config.*`\n   - Remove `serverRuntimeConfig` and `publicRuntimeConfig` from next.config.js\n   - Migrate to environment variables in `.env` files\n\n   **3. PPR Flags Removed:**\n   - Search: `grep -r \"experimental.ppr\\|experimental_ppr\" next.config.* app/ src/`\n   - Remove `experimental.ppr` flag and `experimental_ppr` route exports\n   - Use `experimental.cacheComponents: true` instead\n\n   **4. experimental.dynamicIO Renamed:**\n   - Search: `grep -r \"experimental.dynamicIO\" next.config.*`\n   - Rename to `experimental.cacheComponents`\n\n   **5. unstable_rootParams() Removed:**\n   - Search: `grep -r \"unstable_rootParams\" app/ src/`\n   - Alternative API coming in upcoming minor release\n   - Temporarily use params from props\n\n   **6. Automatic scroll-behavior: smooth Removed:**\n   - No longer automatic\n   - Add `data-scroll-behavior=\"smooth\"` to `<html>` tag if needed\n\n   **7. devIndicators Config Options Removed:**\n   - Search: `grep -r \"devIndicators\" next.config.*`\n   - Remove `appIsrStatus`, `buildActivity`, `buildActivityPosition` options\n   - The dev indicator itself remains\n\n**B. Parallel Routes (NOT handled by codemod)**\n   Files: Check for @ folders (except `@children`)\n   Requirement: All parallel route slots must have `default.js` files\n   Impact: Build fails without them\n\n   **Note:** `@children` is a special implicit slot and does NOT require a `default.js` file.\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Parallel Routes Examples)**\n\n   Quick fix: Create `app/@modal/default.js` (or `@auth`, etc.) that returns `null`\n\n**C. Image Security Config (NOT handled by codemod)**\n   File: next.config.js\n   Check: Are you using local images with query strings?\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Image Configuration Examples)**\n\n   If yes, add `images.localPatterns` config\n\n**D. Image Default Changes (Behavior change)**\n   Note: These defaults changed automatically in v16:\n   - `minimumCacheTTL`: 60s -> 14400s (4 hours)\n   - `qualities`: [1..100] -> [75]\n   - `imageSizes`: removed 16\n   - `dangerouslyAllowLocalIP`: now false by default\n   - `maximumRedirects`: unlimited -> 3\n\n   Action: Review if these affect your app, override in config if needed\n\n**E. Lint Command Migration (NOT handled by codemod)**\n   Files: package.json scripts, CI workflows\n   Check: Scripts using `next lint`\n   Note: `next build` no longer runs linting automatically\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Lint Command Migration)**\n\n   Options:\n   1. Use Biome: `biome check .`\n   2. Use ESLint directly: `<pkg-exec> @next/codemod@canary next-lint-to-eslint-cli .`\n   \n   **Note:** `@next/eslint-plugin-next` now defaults to ESLint Flat Config format, aligning with ESLint v10\n\n**F. next.config.js Turbopack Config Updates (REQUIRED for canary users)**\n   File: next.config.js\n   Check: `turbopackPersistentCachingForDev` config option\n   Action: Rename to `turbopackFileSystemCacheForDev`\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Config Migration Examples)**\n\n   Note: This was a temporary change on canary - not everyone has this config\n   \n   **Additional Turbopack Enhancement:**\n   - Turbopack now automatically enables Babel if a babel config is found\n   - Previously exited with hard error\n   - No action needed - automatic behavior\n\n**G. --turbopack Flags (No Longer Needed)**\n   Files: package.json scripts\n   Check: `next dev --turbopack`, `next build --turbopack`\n   Action: Remove `--turbopack` flags (Turbopack is default in v16)\n   Note: Use `--webpack` flag if you want webpack instead\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Config Migration Examples)**\n\n**H. ESLint Config Removal (REQUIRED)**\n   File: next.config.js\n   Check: `eslint` configuration object\n   Action: Remove eslint config from next.config.js\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Config Migration Examples)**\n\n   Note: ESLint configuration should now be in .eslintrc.json or eslint.config.js\n   Migration: Use `<pkg-exec> @next/codemod@canary next-lint-to-eslint-cli .` if needed\n\n**I. serverComponentsExternalPackages Deprecation (BREAKING)**\n   File: next.config.js\n   Check: `serverComponentsExternalPackages` in experimental config\n   Action: Move out of experimental - this is now a top-level config option\n\n   **üìñ For code examples, see: `nextjs16://migration/examples` (Config Migration Examples)**\n\n   \n   \n\n**K. Edge Cases the Codemod May Miss**\n   Review these manually:\n\n   - Complex async destructuring patterns\n   - Dynamic params in nested layouts\n   - Route handlers with cookies()/headers() in conditionals\n   - Custom metadata generation with complex logic\n   - Metadata image routes (opengraph-image, twitter-image, icon, apple-icon)\n   \n   **üìñ For detailed code examples, see: `nextjs16://migration/examples` (Async API Migration Examples)**\n\n   **CRITICAL: Only change if function actually uses these 5 APIs:**\n   1. `params` from props\n   2. `searchParams` from props\n   3. `cookies()` in body\n   4. `headers()` in body\n   5. `draftMode()` in body\n\n   **Do NOT change:**\n   - `robots()`, `sitemap()`, `manifest()` without these APIs\n   - `generateStaticParams()`\n   - Any function that doesn't use the 5 APIs above\n\n   **METADATA IMAGE ROUTES - Important Changes:**\n   For metadata image route files (opengraph-image, twitter-image, icon, apple-icon):\n   - The function signature remains `{ params, id }` but `params` becomes a Promise\n   - `params` is now async: `await params`\n   - The `id` parameter remains a string (not a Promise)\n   \n   See migration examples resource for complete before/after code\n\n**L. ViewTransition API Renamed (NOT handled by codemod)**\n   Files: Search for imports of `unstable_ViewTransition` from React\n   Action: Rename to `ViewTransition` (now stable in v16)\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (ViewTransition API Migration)**\n\n   - Rename `unstable_ViewTransition` ‚Üí `ViewTransition`\n   - Remove `experimental.viewTransition` flag from next.config.js\n\n**M. revalidateTag API Changes (Deprecation - NOT handled by codemod)**\n   Files: Search for `revalidateTag(` calls\n   Check: All revalidateTag calls now require a profile parameter\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Cache Invalidation Examples)**\n\n   Search: `grep -r \"revalidateTag(\" app/ src/`\n\n   **When to use which:**\n   - Use `updateTag('tag')` in Server Actions when you need immediate consistency (read-your-own-writes, no profile parameter)\n   - Use `revalidateTag('tag', 'max')` in Route Handlers or when background invalidation is acceptable (requires profile parameter)\n\n   Load `nextjs16://knowledge/cache-invalidation` for detailed API semantics and migration patterns.\n\n**N. Middleware to Proxy Migration (NOT handled by codemod)**\n   Files: middleware.ts, next.config.js\n   Check: Middleware-related files and config properties\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (Middleware to Proxy Examples)**\n   \n   The `middleware` concept is being renamed to `proxy` in Next.js 16:\n   \n   **File renames:**\n   - Rename `middleware.ts` ‚Üí `proxy.ts`\n   - Rename named export `middleware` ‚Üí `proxy` in the file\n   \n   **Config property renames:**\n   - `experimental.middlewarePrefetch` ‚Üí `experimental.proxyPrefetch`\n   - `experimental.middlewareClientMaxBodySize` ‚Üí `experimental.proxyClientMaxBodySize`\n   - `experimental.externalMiddlewareRewritesResolve` ‚Üí `experimental.externalProxyRewritesResolve`\n   - `skipMiddlewareUrlNormalize` ‚Üí `skipProxyUrlNormalize`\n   \n   Search: `grep -r \"middlewarePrefetch\\|middlewareClientMaxBodySize\\|externalMiddlewareRewritesResolve\\|skipMiddlewareUrlNormalize\" .`\n\n**O. Build and Dev Improvements (Informational - No action needed)**\n   These improvements are automatic in Next.js 16:\n   \n   - **Terminal Output Redesign:**\n     - Clearer formatting\n     - Better error messages\n     - Improved performance metrics\n   \n   - **Separate Output Directories:**\n     - `next dev` and `next build` now use separate output directories\n     - Enables concurrent execution of both commands\n   \n   - **Lockfile Mechanism:**\n     - Prevents multiple `next dev` or `next build` instances on same project\n     - Prevents conflicts from concurrent builds\n   \n   - **Modern Sass Support:**\n     - `sass-loader` bumped to v16\n     - Supports modern Sass syntax and new features\n     - Automatic - no action needed if using Sass\n   \n   - **Native TypeScript Config (Optional):**\n     - Run with `--experimental-next-config-strip-types` flag to enable native TS for `next.config.ts`\n     - Example: `next dev --experimental-next-config-strip-types`\n\n**P. unstable_noStore Migration (If using Cache Components)**\n   - Search: `grep -r \"unstable_noStore\" app/ src/`\n   - Context: If you plan to enable Cache Components (experimental.cacheComponents)\n   - Action: Remove all `unstable_noStore()` calls - dynamic is the default with Cache Components\n   - Migration: No replacement needed - everything is dynamic by default\n   - Alternative: If content should be cached, use `\"use cache\"` instead\n   \n   **üìñ For code examples, see: `nextjs16://migration/examples` (unstable_noStore Examples)**\n   \n   **Note:** `unstable_noStore()` is only incompatible when Cache Components are enabled. If you're not using Cache Components, you can keep using it.\n\n**Q. Other Deprecated Features (WARNINGS - Optional)**\n   - `next/legacy/image` ‚Üí use `next/image`\n   - `images.domains` ‚Üí use `images.remotePatterns`\n   - `unstable_rootParams()` ‚Üí being replaced\n\n## PHASE 4: Apply Manual Fixes\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nOnly fix issues the codemod missed:\n\n**üìñ For all code examples, see: `nextjs16://migration/examples`**\n\nBased on Phase 3 analysis, apply only the necessary manual fixes:\n\n**1. Remove completely removed features (if found in Phase 3 section A)**\n   - Remove AMP-related code\n   - Migrate runtime configs to environment variables\n   - Remove PPR flags\n   - Rename experimental.dynamicIO to cacheComponents\n   - Remove unstable_rootParams() usage\n   - Add data-scroll-behavior attribute if needed\n   - Remove devIndicators config options\n   \n   See: `nextjs16://migration/examples` ‚Üí Removed Features Examples\n\n**2. Add missing default.js files (if you have @ folders)**\n   \n   See: `nextjs16://migration/examples` ‚Üí Parallel Routes Examples\n\n**3. Add image security config (if using local images with query strings)**\n   \n   See: `nextjs16://migration/examples` ‚Üí Image Configuration Examples\n\n**4. Update lint commands (if using next lint in scripts/CI)**\n   \n   See: `nextjs16://migration/examples` ‚Üí Lint Command Migration\n\n**5. Fix revalidateTag calls (see section M in Phase 3)**\n   - Update all `revalidateTag(tag)` calls to include profile parameter\n   - Use `updateTag(tag)` for Server Actions (read-your-own-writes, no profile parameter)\n   - Use `revalidateTag(tag, 'max')` for Route Handlers (background invalidation, requires profile parameter)\n   \n   See: `nextjs16://migration/examples` ‚Üí Cache Invalidation Examples\n\n**6. Migrate middleware to proxy (see section N in Phase 3)**\n   - Rename middleware.ts to proxy.ts\n   - Update config properties\n   \n   See: `nextjs16://migration/examples` ‚Üí Middleware to Proxy Examples\n\n**7. Remove unstable_noStore (see section P in Phase 3 - if using Cache Components)**\n   - Remove all `unstable_noStore()` calls\n   - Remove imports: `import { unstable_noStore } from 'next/cache'`\n   - No replacement needed - dynamic by default with Cache Components\n   - Add migration comments explaining removal\n   \n   See: `nextjs16://migration/examples` ‚Üí unstable_noStore Examples\n\n**8. Fix edge cases the codemod missed (RARE - only if found in Phase 3 section K)**\n   \n   See: `nextjs16://migration/examples` ‚Üí Async API Migration Examples\n\n## OUTPUT FORMAT\n‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\nReport findings in this format:\n\n```\n# Next.js 16 Upgrade Report\n\n## Summary\n- Current Version: [version]\n- On Beta: [Yes/No] - If yes, will upgrade to stable\n- Target Version: 16 (stable channel)\n- Package Manager: [npm/pnpm/yarn/bun]\n- Monorepo: [Yes/No]\n- If Monorepo, Apps to Upgrade: [list of app directories]\n\n## Phase 1: Pre-Flight Checks\n[ ] Monorepo structure detected (if applicable, list all Next.js apps)\n[ ] Working directory: [current app directory path]\n[ ] Node.js version (20.9+)\n[ ] TypeScript version checked (5.1+)\n[ ] Browser support requirements reviewed (Chrome 111+, Edge 111+, Firefox 111+, Safari 16.4+)\n[ ] Current Next.js version documented\n[ ] Git working directory is clean (no uncommitted changes)\n\n## Phase 2: Codemod Execution\n- [ ] Checked current version: On beta? [Yes/No]\n- [ ] If on beta: Noted to review beta-to-stable guide after upgrade\n- [ ] If already on stable: Skipped codemod (no reinstall needed)\n- [ ] If NOT on stable: Ran codemod: `<pkg-exec> @next/codemod@canary upgrade latest`\n- [ ] Selected \"yes\" for all codemod prompts\n- [ ] Codemod upgraded Next.js, React, and React DOM to stable\n- [ ] Codemod upgraded React type definitions to stable\n- [ ] Codemod applied automatic fixes\n- [ ] TypeScript upgraded if needed: `<pkg-manager> add -D typescript@latest`\n- [ ] Reviewed git diff for codemod changes\n- [ ] **Verified build: `<pkg-manager> run build` (if this passes, upgrade is complete!)**\n- [ ] **Browser verification with browser_eval (RECOMMENDED):**\n  - [ ] Started dev server: `<pkg-manager> run dev`\n  - [ ] Started browser automation with action=\"start\"\n  - [ ] Navigated to key routes and verified pages load\n  - [ ] Checked for console errors with action=\"console_messages\"\n  - [ ] Closed browser with action=\"close\"\n  - [ ] No client-side errors or hydration issues detected\n\n## Phase 3: Issues Requiring Manual Fixes\nIssues the codemod couldn't handle:\n[ ] A. Removed features check:\n  [ ] AMP support removal\n  [ ] Runtime config removal (serverRuntimeConfig, publicRuntimeConfig)\n  [ ] PPR flags removal (experimental.ppr, experimental_ppr)\n  [ ] experimental.dynamicIO ‚Üí cacheComponents rename\n  [ ] unstable_rootParams() removal\n  [ ] Automatic scroll-behavior: smooth removal\n  [ ] devIndicators config options removal\n[ ] B. Parallel routes missing default.js\n[ ] C. Image security config needed\n[ ] D. Image default changes reviewed\n[ ] E. Lint commands to update (ESLint flat config default noted)\n[ ] F. next.config.js: turbopackPersistentCachingForDev ‚Üí turbopackFileSystemCacheForDev (Babel auto-enabled noted)\n[ ] G. Remove --turbopack flags from scripts\n[ ] H. next.config.js: Remove eslint config object\n[ ] I. next.config.js: Move serverComponentsExternalPackages out of experimental\n[ ] K. Edge cases in async APIs\n[ ] L. ViewTransition API renamed (unstable_ViewTransition ‚Üí ViewTransition, remove experimental.viewTransition flag)\n[ ] M. revalidateTag API changes\n[ ] N. Middleware to Proxy migration (rename middleware.ts ‚Üí proxy.ts and config properties)\n[ ] O. Build and dev improvements reviewed (informational)\n[ ] P. unstable_noStore removal (if using Cache Components)\n[ ] Q. Deprecated features to update\n\n## Files Requiring Manual Changes\n- path/to/file1.ts (reason - not handled by codemod)\n- path/to/file2.tsx (reason - not handled by codemod)\n...\n\n## Phase 4: Manual Changes Applied\n- [List of manual fixes made]\n- [ ] **Final build verification: `<pkg-manager> run build` (must succeed)**\n- [ ] **Final browser verification with browser_eval:**\n  - [ ] All key routes load successfully in browser\n  - [ ] No console errors or warnings\n  - [ ] Client-side hydration works correctly\n\n## Completion Status\n- [ ] Upgrade complete - build succeeds without errors\n- [ ] Browser verification passed (using browser_eval, not curl)\n- [ ] All manual fixes applied (if any were needed)\n\n## Next Steps\n- [What to do next, e.g., commit changes, test in staging, etc.]\n```\n\n# START HERE\nBegin migration:\n1. **FIRST: Check if this is a monorepo** - If yes, navigate to each Next.js app directory and run the workflow there (NOT at monorepo root)\n2. Start with Phase 1 pre-flight checks (ensure clean git state)\n3. Run the codemod in Phase 2 (this handles most changes automatically)\n4. **Verify with build** - If `<pkg-manager> run build` succeeds, continue to browser verification\n5. **Verify with browser_eval** - Use the browser_eval MCP tool to load pages in a real browser (NOT curl). This catches client-side errors that build verification misses\n6. Only if build or browser verification fails, proceed to Phase 3 and Phase 4 to fix remaining issues\n\n**‚ö†Ô∏è CRITICAL: Always use browser_eval for page verification, never curl or simple HTTP requests. browser_eval actually renders the page and detects runtime errors, hydration issues, and JavaScript problems that curl cannot catch.**\n\n**‚ö†Ô∏è MONOREPO USERS:** If you're in a monorepo, you MUST be in the specific Next.js app directory (e.g., `apps/web/`) before starting. The codemod will fail if run from the monorepo root.\n","type":"structured_guidance","note":"This tool provides detailed step-by-step guidance. Follow the phases in order for successful upgrade."}
```
